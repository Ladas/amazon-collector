#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path("../lib", __dir__)
require "bundler/setup"
require "topological_inventory/amazon/operations/worker"

queue_host = ENV["QUEUE_HOST"] || "localhost"
queue_port = ENV["QUEUE_PORT"] || 9092

SourcesApiClient.configure do |config|
  config.scheme = ENV["SOURCES_SCHEME"]
  config.host   = "#{ENV["SOURCES_HOST"]}:#{ENV["SOURCES_PORT"]}"
end

TopologicalInventory::Amazon::MessagingClient.configure do |config|
  config.queue_host = queue_host
  config.queue_port = queue_port
end

begin
  operations_worker = TopologicalInventory::Amazon::Operations::Worker.new
  operations_worker.run
rescue => err
  puts err
  raise
end
